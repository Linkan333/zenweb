{% extends "base.html" %}

{% block title %}{{ current_user.username }} - Dashboard{% endblock %}

{% block content %}
<div class="d-flex">
    <nav class="navbar navbar-dark p-3" style="width: 300px; height: 100vh; position: fixed;">
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a href="#" class="nav-link text-white mb-3" aria-current="page">
                    <i class="fa-solid fa-wallet"></i> Wallets
                </a>
            </li>
            <li class="nav-item">
                <a onclick="showDashboard()" class="nav-link text-white mb-3">
                    <i class="fa-solid fa-table-columns"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link text-white mb-3">
                    <i class="fa-solid fa-chart-simple"></i> Stats
                </a>
            </li>
            <li class="nav-item">
                <a onclick="showBilling()" class="nav-link text-white mb-3" style="cursor: pointer;">
                    <i class="fa-solid fa-file-invoice"></i> Billing
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link text-white mt-5">
                    <i class="fa-solid fa-gear"></i> Settings
                </a>
            </li>
            <li class="nav-item">
                <a onclick="showTicket()" class="nav-link text-white mt-3" style="cursor: pointer;">
                    <i class="fa-solid fa-ticket"></i> Ticket
                </a>
            </li>
        </ul>
    </nav>

    <!-- Ticket Contents -->
    <div class="card connectWithUs" id="ticketContents" style="display: none; margin-left: 320px;">
        <div class="card-header">
            Connect With Us
        </div>

        <div class="card-body">
            <h5 class="card-title">Contact us by submitting a ticket.</h5>
            <a href="#" id="ticketbutton" onclick="ticketCreateFunction()" style="display: block; text-align: center; width: 200px;" class="primary-btn">Create Ticket</a>

            <div class="form-container mt-4">
                <div class="priorityLevel" id="priorityLevel" style="display: none; width: 300px;">
                    <p style="position: relative; left: 66px;"><small class="text-light">Priority</small></p>
                    <button type="button" class="btn btn-outline-info"><i class="fa-solid fa-circle-info"></i> Low</button>
                    <button type="button" class="btn btn-outline-warning"><i class="fa-solid fa-exclamation"></i> High</button>
                    <button type="button" class="btn btn-outline-danger"><i class="fa-solid fa-triangle-exclamation"></i> Critical</button>
                </div>

                <div class="ticketForm" id="ticketForm" style="display: none;">
                    <form id="ticketForm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" placeholder="Enter your name" required>
                        </div>

                        <div class="mb-3">
                            <label for="subject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="subject" placeholder="Ticket Subject" required>
                        </div>

                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" rows="4" placeholder="Describe your issue" required></textarea>
                        </div>

                        <a href="#" class="primary-btn" id="submitTicket">Submit Ticket</a>
                    </form>
                </div>
            </div>
        </div>
        <div class="history-section">
            <h6 class="mb-3">Support History</h6>
            <ul class="list-group mb-3">
                <li class="list-group-item historySupport d-flex justify-content-between align-items-center">
                    Wallet Bug
                    <span>Priority</span>
                    <span style="color: #dc3545;"><i class="fa-solid fa-triangle-exclamation"></i> Critical</span>
                </li>
                <li class="list-group-item historySupport d-flex  justify-content-between align-items-center">
                    Plan bug
                    <span>Priority</span>
                    <span style="color: #17a2b8"><i class="fa-solid fa-circle-info"></i> Low</span>
                </li>
                <li class="list-group-item historySupport d-flex justify-content-between align-items-center">
                    Account bug
                    <span>Priority</span>
                    <span style="color: #ffc107"><i class="fa-solid fa-exclamation"></i> High</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- For the Dashboard -->
    <div class="container mt-5" id="dashboardContainer" style="display: none;">
        <!-- Chart Section -->
        <div class="revenue-card mb-5">
            <!-- Revenue Header -->
            <div class="revenue-header d-flex justify-content-between">
                <div>
                    <h5 id="headerPreviousWeek">Previous Week</h5>
                    <h2 id="previousWeekStats">$69,524 <span style="color: #ec650c;">●</span></h2>
                </div>
                <div>
                    <h5 id="headerCurrentWeek">Current Week</h5>
                    <h2 id="currentWeekStats">$58,254 <span style="color: blue;">●</span></h2>
                </div>
            </div>
    
            <!-- Earnings Section -->
            <div>
                <p class="stats-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ultricies nisl euismod magna.</p>
            </div>
    
            <!-- Chart -->
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    
        <!-- Stats Cards Section -->
        <div class="row">
            <div class="col-md-6 col-lg-3">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fa-solid fa-eye"></i>
                    </div>
                    <h2>5,543</h2>
                    <p>Trade Stats</p>
                    <p>Since last week <span class="text-red">1.08% <i class="fa fa-arrow-down"></i></span></p>
                </div>
            </div>
    
            <div class="col-md-6 col-lg-3">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fa-solid fa-code-pull-request"></i>
                    </div>
                    <h2>20</h2>
                    <p>Volume Bot Requests</p>
                    <p>Since last week <span class="text-green">5.27% <i class="fa fa-arrow-up"></i></span></p>
                </div>
            </div>
    
            <div class="col-md-6 col-lg-3">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fa fa-chart-line"></i>
                    </div>
                    <h2>+30.56%</h2>
                    <p>Growth</p>
                    <p>Since last week <span class="text-green">4.87% <i class="fa fa-arrow-up"></i></span></p>
                </div>
            </div>
    
            <div class="col-md-6 col-lg-3">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fa fa-dollar-sign"></i>
                    </div>
                    <h2>8 SOL</h2>
                    <p>Revenue</p>
                    <p>Since last week <span class="text-red">7.00% <i class="fa fa-arrow-down"></i></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Billing Card (Moved outside of ticketContents) -->
    <div class="card billing-card mb-4" id="billing-card" style="display: none; width: 900px; margin-left: 320px;">
        <div class="card-header">
            Billing
        </div>
        <dv class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="card-title" style="margin-left: 15px;">Choose a plan below</h5>
            </div>

            <div class="plan-section">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card plan-card">
                            <div class="card-header text-center">
                                <h6>ZenBas Plan</h6>
                                <p class="price">5 SOL / <small>month</small></p>
                            </div>
                            <div class="card-body">
                                <ul class="list-group">
                                    <li class="list-group-item">15 Volume Bot Requests per month</li>
                                    <li class="list-group-item">5 Wallets Generated</li>
                                    <li class="list-group-item">Basic Support</li>
                                </ul>
                            </div>
                            <div class="card-footer text-center">
                                <a class="primary-btn" id="renewPlanBtn">Select Plan</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card plan-card">
                            <div class="card-header text-center">
                                <h6>ZenSta Plan</h6>
                                <p class="price">8 SOL / <small>month</small></p>
                            </div>
                            <div class="card-body">
                                <ul class="list-group">
                                    <li class="list-group-item">25 Volume Bot Requests per month</li>
                                    <li class="list-group-item">15 Wallets Generated</li>
                                    <li class="list-group-item">Priority Support</li>
                                </ul>
                            </div>
                            <div class="card-footer text-center">
                                <a class="primary-btn" id="renewPlanBtn">Select Plan</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card plan-card">
                            <div class="card-header text-center">
                                <h6>ZenPre Plan</h6>
                                <p class="price">13 SOL / <small>month</small></p>
                            </div>
                            <div class="card-body">
                                <ul class="list-group">
                                    <li class="list-group-item">40 Volume Bot Requests per month</li>
                                    <li class="list-group-item">20 Wallets Generated</li>
                                    <li class="list-group-item">Priority Support</li>
                                </ul>
                            </div>
                            <div class="card-footer text-center">
                                <a class="primary-btn" id="renewPlanBtn">Select Plan</a>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div class="justify-content-end mt-4">
                <a href="#" class="primary-btn me-2" id="renewPlanBtn">Renew Plan</a>
            </div>
        </div>
    </div>

<!-- JavaScript -->
<script>
    function showTicket() {
        document.getElementById("ticketContents").style.display = 'block';
        document.getElementById("billing-card").style.display = 'none';
        document.getElementById("dashboardContainer").style.display = 'none';
    }

    function showBilling() {
        document.getElementById("billing-card").style.display = 'block';
        document.getElementById("ticketContents").style.display = 'none';
        document.getElementById("dashboardContainer").style.display = 'none';
    }

    function showDashboard() {
        document.getElementById("billing-card").style.display = 'none';
        document.getElementById("ticketContents").style.display = 'none';
        document.getElementById("dashboardContainer").style.display = 'block';
    }

    function ticketCreateFunction() {
        document.getElementById("ticketForm").style.display = 'block';
        document.getElementById("ticketbutton").style.display = 'none';
        document.getElementById("priorityLevel").style.display = 'block';
    }

    // Initialize the Chart.js chart after the page loads
    window.onload = function() {
    var ctx = document.getElementById('revenueChart').getContext('2d');
    var revenueChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                data: [20000, 25000, 22000, 27000, 29000, 30000, 25000],
                borderColor: '#ec650c',
                fill: false,
                lineTension: 0.4,
                borderWidth: 3,
                pointRadius: 0
            }, {
                data: [18000, 23000, 20000, 24000, 25000, 27000, 22000],
                borderColor: 'blue',
                fill: false,
                lineTension: 0.4,
                borderWidth: 3,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false  // Hide the legend
                },
                tooltip: {
                    enabled: true,  // Enable tooltips
                    mode: 'index',  // Show tooltips for all datasets at once
                    intersect: false,  // Ensure tooltips are shown when hovering near the lines, not just directly on points
                    callbacks: {
                        label: function(context) {
                            // Customize the tooltip label format
                            let label = context.dataset.borderColor === '#ec650c' ? 'Previous Week' : 'Current Week';
                            return label + ': ' + context.formattedValue + ' USD';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: '#0b0d2a9e'
                    },
                    ticks: {
                        color: '#0b0d2a9e'
                    }
                },
                x: {
                    grid: {
                        color: '#0b0d2a9e'
                    },
                    ticks: {
                        color: '#fff'
                    }
                }
            }
        }
    });
};
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
